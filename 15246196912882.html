<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  zabbix3.2/3.4 部署安装 - An Honglei ’s Blog
  
  </title>
 <meta name="description" content="学习是痛并快乐着！！！">
 <link href="atom.xml" rel="alternate" title="An Honglei ’s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">An Honglei ’s Blog</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; An Honglei ’s Blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>监控</label></li>

          
            <li><a title="IPMI-DELL" href="15287735246134.html">IPMI-DELL</a></li>
          
            <li><a title="VM WARE esxi" href="15286986347471.html">VM WARE esxi</a></li>
          
            <li><a title="IO监控" href="15284429017864.html">IO监控</a></li>
          
            <li><a title="zookeeper" href="15284264486830.html">zookeeper</a></li>
          
            <li><a title="docker" href="15284264396270.html">docker</a></li>
          
            <li><a title="redis" href="15284264338352.html">redis</a></li>
          
            <li><a title="mongodb" href="15284264265436.html">mongodb</a></li>
          
            <li><a title="mysql" href="15284264221433.html">mysql</a></li>
          
            <li><a title="nginx" href="15284264147825.html">nginx</a></li>
          
            <li><a title="JVM" href="15284264028937.html">JVM</a></li>
          
            <li><a title="配置报警-邮件和微信" href="15284261636485.html">配置报警-邮件和微信</a></li>
          
            <li><a title="自动发现设置" href="15284261175013.html">自动发现设置</a></li>
          
            <li><a title="Alertmanager报警模块" href="15270467833243.html">Alertmanager报警模块</a></li>
          
            <li><a title="运维监控工作规划" href="15264350522088.html">运维监控工作规划</a></li>
          
            <li><a title="# Prometheus 简介及安装" href="15258517853636.html"># Prometheus 简介及安装</a></li>
          
            <li><a title="部署 Prometheus 基础环境" href="15258308100903.html">部署 Prometheus 基础环境</a></li>
          
            <li><a title="prometheus监控调研方案" href="15257584688763.html">prometheus监控调研方案</a></li>
          
            <li><a title="监控迁移过程注意事项整理" href="15253278795397.html">监控迁移过程注意事项整理</a></li>
          
            <li><a title="zabbix3.2升级到3.4" href="15246459775922.html">zabbix3.2升级到3.4</a></li>
          
            <li><a title="zabbix3.2/3.4 部署安装" href="15246196912882.html">zabbix3.2/3.4 部署安装</a></li>
          
            <li><a title="天兔" href="15243054043731.html">天兔</a></li>
          

      
        <li class="divider"></li>
        <li><label>Python</label></li>

          
            <li><a title="基础知识练习" href="15221590998154.html">基础知识练习</a></li>
          
            <li><a title="python 基础" href="15214289229123.html">python 基础</a></li>
          

      
        <li class="divider"></li>
        <li><label>基础整理</label></li>

          
            <li><a title="LINUX 快捷键整理" href="15306935051951.html">LINUX 快捷键整理</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>监控</span></li>
                        
                          <li><a title="IPMI-DELL" href="15287735246134.html">IPMI-DELL</a></li>
                        
                          <li><a title="VM WARE esxi" href="15286986347471.html">VM WARE esxi</a></li>
                        
                          <li><a title="IO监控" href="15284429017864.html">IO监控</a></li>
                        
                          <li><a title="zookeeper" href="15284264486830.html">zookeeper</a></li>
                        
                          <li><a title="docker" href="15284264396270.html">docker</a></li>
                        
                          <li><a title="redis" href="15284264338352.html">redis</a></li>
                        
                          <li><a title="mongodb" href="15284264265436.html">mongodb</a></li>
                        
                          <li><a title="mysql" href="15284264221433.html">mysql</a></li>
                        
                          <li><a title="nginx" href="15284264147825.html">nginx</a></li>
                        
                          <li><a title="JVM" href="15284264028937.html">JVM</a></li>
                        
                          <li><a title="配置报警-邮件和微信" href="15284261636485.html">配置报警-邮件和微信</a></li>
                        
                          <li><a title="自动发现设置" href="15284261175013.html">自动发现设置</a></li>
                        
                          <li><a title="Alertmanager报警模块" href="15270467833243.html">Alertmanager报警模块</a></li>
                        
                          <li><a title="运维监控工作规划" href="15264350522088.html">运维监控工作规划</a></li>
                        
                          <li><a title="# Prometheus 简介及安装" href="15258517853636.html"># Prometheus 简介及安装</a></li>
                        
                          <li><a title="部署 Prometheus 基础环境" href="15258308100903.html">部署 Prometheus 基础环境</a></li>
                        
                          <li><a title="prometheus监控调研方案" href="15257584688763.html">prometheus监控调研方案</a></li>
                        
                          <li><a title="监控迁移过程注意事项整理" href="15253278795397.html">监控迁移过程注意事项整理</a></li>
                        
                          <li><a title="zabbix3.2升级到3.4" href="15246459775922.html">zabbix3.2升级到3.4</a></li>
                        
                          <li><a title="zabbix3.2/3.4 部署安装" href="15246196912882.html">zabbix3.2/3.4 部署安装</a></li>
                        
                          <li><a title="天兔" href="15243054043731.html">天兔</a></li>
                        

                    
                      <li class="side-title"><span>Python</span></li>
                        
                          <li><a title="基础知识练习" href="15221590998154.html">基础知识练习</a></li>
                        
                          <li><a title="python 基础" href="15214289229123.html">python 基础</a></li>
                        

                    
                      <li class="side-title"><span>基础整理</span></li>
                        
                          <li><a title="LINUX 快捷键整理" href="15306935051951.html">LINUX 快捷键整理</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>zabbix3.2/3.4 部署安装</h1>

<ul>
<li>
<a href="#toc_0"></a>
<ul>
<li>
<a href="#toc_1">部署流程</a>
<ul>
<li>
<a href="#toc_2">1.  选择Zabbix版本</a>
</li>
<li>
<a href="#toc_3">2. 安装系统环境</a>
</li>
<li>
<a href="#toc_4">3. 安装和配置Zabbix服务器</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<h2 id="toc_0"></h2>

<p>zabbix官网：<a href="http://www.zabbix.com">http://www.zabbix.com</a><br/>
zabbix下载地址：<a href="http://www.zabbix.com/download">http://www.zabbix.com/download</a><br/>
zabbix下载地址：<a href="https://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/">https://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/</a><br/>
zabbix监控模板：<a href="https://share.zabbix.com/search-by/tags?value=netkiller">https://share.zabbix.com/search-by/tags?value=netkiller</a></p>

<h3 id="toc_1">部署流程</h3>

<h4 id="toc_2">1.  选择Zabbix版本</h4>

<p><a href="https://www.zabbix.com/life_cycle_and_release_policy">https://www.zabbix.com/life_cycle_and_release_policy</a></p>

<h4 id="toc_3">2. 安装系统环境</h4>

<pre><code>yum install -y unixODBC unixODBC-devel net-snmp net-snmp-devel java-devel libssh2-devel OpenIPMI ipmitool
 OpenIPMI-devel fping php-devel libevent-devel
</code></pre>

<p>安装php及组件</p>

<pre><code>cd /data/source/
./sm
18,19
</code></pre>

<p>PHP安装bcmach</p>

<pre><code>ln -s /usr/local/php-5.4.26 /usr/local/php
cd /data/source/
tar zxf php-5.4.26.tar.gz
cd /data/source/php-5.4.26/ext/bcmath
phpize
./configure --with-php-config=/usr/local/php/bin/php-config
make &amp;&amp; make install
cd /data/source/php-5.4.26/ext/gettext/
phpize
./configure --with-php-config=/usr/local/php/bin/php-config
make &amp;&amp; make install

cd /data/install/php-5.4.26/ext/ldap
phpize
cp -frp /usr/lib64/libldap* /usr/lib/
./configure --with-php-config=/usr/local/php/bin/php-config --with-ldap
make &amp;&amp; make install


vi /home/server_config/php/php.ini.5.4
在910行处添加：
extension=bcmath.so
extension=gettext.so
extension=ldap.so
</code></pre>

<p>优化php.ini</p>

<pre><code>cp /home/server_config/php/php.ini.5.4 /home/server_config/php/php.ini.5.4.default
sed -i &quot;s/;date.timezone =/date.timezone = Asia\/Shanghai/g&quot; /home/server_config/php/php.ini.5.4
sed -i &quot;s#max_execution_time = 30#max_execution_time = 300#g&quot; /home/server_config/php/php.ini.5.4
sed -i &quot;s#post_max_size = 8M#post_max_size = 32M#g&quot; /home/server_config/php/php.ini.5.4
sed -i &quot;s#max_input_time = 60#max_input_time = 300#g&quot; /home/server_config/php/php.ini.5.4
sed -i &quot;s#memory_limit = 128M#memory_limit = 128M#g&quot; /home/server_config/php/php.ini.5.4
#sed -i &quot;/;mbstring.func_overload = 0/ambstring.func_overload = 2\n&quot; /home/server_config/php/php.ini.5.4
mkdir /etc/php-fpm
ln -s /home/server_config/php-fpm/php-fpm.conf.5.4.26 /etc/php-fpm/php-fpm.conf
ln -s /home/server_config/php-fpm/php-fpm /etc/init.d/php-fpm
/etc/init.d/php-fpm restart
</code></pre>

<h4 id="toc_4">3. 安装和配置Zabbix服务器</h4>

<pre><code>下载地址：
https://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/3.4.8/zabbix-3.4.8.tar.gz

groupadd -g 201 zabbix
useradd -u 201 -g zabbix -d /var/lib/zabbix -s /sbin/nologin -c &quot;Zabbix System User&quot; zabbix
cd /usr/local/src
wget https://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/3.4.8/zabbix-3.4.8.tar.gz
tar zxf zabbix-3.4.8.tar.gz
cd zabbix-3.4.8
./configure --prefix=/usr/local/zabbix-3.4.8 --sysconfdir=/etc/zabbix --enable-server --enable-proxy --enable-agent --enable-ipv6 --with-mysql=/usr/local/mysql-5.7.20/bin/mysql_config --with-net-snmp  --with-libxml2 --with-libcurl --with-openipmi --with-openssl --with-unixodbc --with-ldap --with-ssh2 --enable-java
make &amp;&amp; make install
ln -s /usr/local/zabbix-3.4.8 /usr/local/zabbix
mkdir /var/log/zabbix
chown -R zabbix.zabbix /var/log/zabbix
</code></pre>

<p>创建zabbix数据库和用户</p>

<pre><code>create database zabbix character set utf8;
grant all privileges on zabbix.* to zabbix@localhost identified by &#39;Zabbix@2016&#39;;
grant all privileges on zabbix.* to zabbix@&#39;127.0.0.1&#39; identified by &#39;Zabbix@2016&#39;;
</code></pre>

<p>导入zabbix数据库</p>

<pre><code>use zabbix;
source /usr/local/src/zabbix-3.4.8/database/mysql/schema.sql;
source /usr/local/src/zabbix-3.4.8/database/mysql/images.sql;
source /usr/local/src/zabbix-3.4.8/database/mysql/data.sql;

将原数据库导入即可

</code></pre>

<p>修改配置</p>

<pre><code>cp /etc/zabbix/zabbix_server.conf /etc/zabbix/zabbix_server.conf.default
配置server.conf
vi /etc/zabbix/zabbix_server.conf
LogFile=/var/log/zabbix/zabbix_server.log
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=Zabbix@2016
DBSocket=/tmp/mysql3306.sock
DBPort=3306
StartPollers=160
StartTrappers=20
StartPingers=100
StartDiscoverers=120
MaxHousekeeperDelete=5000
CacheSize=1024M
StartDBSyncers=16
HistoryCacheSize=1024M
TrendCacheSize=1024M
AlertScriptsPath=/etc/zabbix/alertscripts
FpingLocation=/usr/sbin/fping
LogSlowQueries=1000

cp /etc/zabbix/zabbix_agentd.conf /etc/zabbix/zabbix_agentd.conf.default
配置agentd.conf
vi /etc/zabbix/zabbix_agentd.conf
LogFile=/var/log/zabbix/zabbix_agentd.log
EnableRemoteCommands=0
Server=127.0.0.1,172.18.100.232
StartAgents=8
ServerActive=172.18.100.232:10051
Hostname=zabbix.yg.com
Timeout=30
Include=/etc/zabbix/zabbix_agentd.conf.d/
UnsafeUserParameters=1

迁移时将/etc/zabbix目录覆盖即可
</code></pre>

<p>增加系统&amp;开机配置</p>

<pre><code>cp /usr/local/src/zabbix-3.4.8/misc/init.d/fedora/core/zabbix_* /etc/init.d/
chmod 755 /etc/init.d/zabbix_*
sed -i &quot;s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix/#g&quot; /etc/init.d/zabbix_server
sed -i &quot;s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix/#g&quot; /etc/init.d/zabbix_agentd
chkconfig --add zabbix_agentd
chkconfig --add zabbix_server
chkconfig zabbix_agentd on
chkconfig zabbix_server on

启动zabbix
/etc/init.d/zabbix_server start
/etc/init.d/zabbix_agentd start
</code></pre>

<p>配置nginx WEB访问</p>

<pre><code>mkdir -p /data/www
cd /usr/local/src/zabbix-3.4.8
cp -r ./frontends/php/ /data/www/zabbix
chown -R nobody.nobody /data/www/zabbix/

**配置nginx**
cd /usr/local/nginx/conf/vhosts
cp test.conf.example zabbix.bjtuling.com.conf
vi zabbix.bjtuling.com.conf
server {
listen 80;
server_name zabbix.bjtuling.com;
index index.php index.html index.htm;
root /data/www/zabbix;
location ~ /.svn/ {
deny all;
}
location ~ ^.*\.(htaccess|zip|gz|tgz)$ {
deny all;
}
location ~* ^/(attachments|images|upload)/.*\.(php|php5)$ {
deny all;
}
location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
expires 7d;
}
location ~ .*\.(js|css)?$ {
expires 24h;
}
location ~ .*\.php?$ {
fastcgi_pass 127.0.0.1:9000;
fastcgi_index index.php;
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#fastcgi_param HTTPS on;
include fastcgi_params;
}
}

迁移：将vhosts目录下所有配置拷贝过来即可

</code></pre>

<p>开启防火墙</p>

<pre><code>${IPTABLES} -A INPUT -p tcp --dport 10050 -j ACCEPT
${IPTABLES} -A INPUT -p tcp --dport 10051 -j ACCEPT
迁移时，拷贝原服务器/home/server_config/iptables_rules/配置
</code></pre>

<p>配置zabbix web页面<br/>
忽略</p>

<p>解决zabbix中文乱码</p>

<pre><code>cd /usr/local/src
wget http://bjqw-dl.bjtuling.com:8180/zabbix/simkai.ttf
cp simkai.ttf /data/www/zabbix/fonts/
sed -i &#39;s/DejaVuSans/simkai/g&#39; /data/www/zabbix/include/defines.inc.php
</code></pre>

<p>部署Client端</p>

<pre><code>1. 下载&amp;安装
cd /usr/local/src
wget http://netix.dl.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/3.0.4/zabbix-3.0.4.tar.gz
tar zxf zabbix-3.0.4.tar.gz
cd zabbix-3.0.4
./configure --prefix=/usr/local/zabbix-3.0.4 --sysconfdir=/etc/zabbix --enable-agent
make &amp;&amp; make install
ln -s /usr/local/zabbix-3.0.4 /usr/local/zabbix
mkdir /var/log/zabbix
chown -R zabbix.zabbix /var/log/zabbix
cp /etc/zabbix/zabbix_agentd.conf /etc/zabbix/zabbix_agentd.conf.default
cp misc/init.d/fedora/core/zabbix_agentd /etc/init.d/
sed -i &quot;s#BASEDIR=/usr/local#BASEDIR=/usr/local/zabbix/#g&quot; /etc/init.d/zabbix_agentd
chmod 755 /etc/init.d/zabbix_agentd
2. 修改配置文件
vi /etc/zabbix/zabbix_agentd.conf
LogFile=/var/log/zabbix/zabbix_agentd.log
EnableRemoteCommands=0
Server=120.26.44.156
StartAgents=8
ServerActive=120.26.44.156:10051
Hostname=zabbix.play800.cn
Timeout=30
Include=/etc/zabbix/zabbix_agentd.conf.d/
UnsafeUserParameters=1
3. 增加开机启动
chkconfig --add zabbix_agentd
chkconfig zabbix_agentd on
/etc/init.d/zabbix_agentd start
</code></pre>

<p>自动化安装脚本</p>

<pre><code>1. zabbix客户端安装脚本
cd /usr/local/src ;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_agent_3.2.6.sh ; sh init_zabbix_agent_3.2.6.sh
zabbix客户端相关脚本
1. 监控nginx
zabbix server 导入nginx模板
zabbix agent 配置
mkdir /etc/zabbix/scripts/ ;
wget -O /etc/zabbix/scripts/ngx_status.sh http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/ngx_status.sh;
wget -O /etc/zabbix/zabbix_agentd.conf.d/userparameter_nginx.conf http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_agentd.conf.d/userparameter_nginx.conf;
chown -R zabbix.zabbix /etc/zabbix/;
chmod 755 /etc/zabbix/scripts/ngx_status.sh;
/etc/init.d/zabbix_agentd restart
一句话安装脚本
cd /usr/loca/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_ngx_status.sh;sh init_zabbix_ngx_status.sh
2. 监控mysql多实例
zabbix server 导入mysql监控模板
zabbix agent 配置
yum install -y php php-mysql;
chmod +s /bin/netstat;
mkdir /etc/zabbix/scripts;
cd /etc/zabbix/scripts;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/get_mysql_stats_wrapper.sh;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/mysql_low_discovery.sh;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/ss_get_mysql_stats.php;
cd /etc/zabbix/zabbix_agentd.conf.d;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_agentd.conf.d/userparameter_percona_mysql.conf;
chown -R zabbix.zabbix /etc/zabbix/;
chmod 755 /etc/zabbix/scripts/*;
/etc/init.d/zabbix_agentd restart
一句话安装脚本
cd /usr/local/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_mysql_multi_status.sh;sh init_zabbix_mysql_multi_status.sh
3. 监控tomcat多实例
zabbix server 导入tomcat监控模板
zabbix agent 配置
mkdir /etc/zabbix/scripts;
cd /etc/zabbix/scripts;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/jmx_discovery.sh;
cd /etc/zabbix/zabbix_agentd.conf.d;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/userparameter_tomcat.conf;
chown -R zabbix.zabbix /etc/zabbix/;
chmod 755 /etc/zabbix/scripts/*;
/etc/init.d/zabbix_agentd restart
一句话安装脚本
cd /usr/local/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_tomcat_multi_status.sh;sh init_zabbix_tomcat_multi_status.sh
4. 监控redis多实例
在zabbix后台，导入模板
下载脚本，并重启zabbix_agentd
chmod +s /bin/netstat;
mkdir /etc/zabbix/scripts;
cd /etc/zabbix/scripts;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/redis_stats.sh;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/redis_discovery.py;
cd /etc/zabbix/zabbix_agentd.conf.d;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/redis_status.conf;
chown -R zabbix.zabbix /etc/zabbix/;
chmod 755 /etc/zabbix/scripts/*;
/etc/init.d/zabbix_agentd restart
一句话安装脚本
cd /usr/local/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_redis_status.sh;sh init_zabbix_redis_status.sh
5. 监控mongodb
在zabbix后台，导入模板
下载脚本，并重启zabbix_agentd
chmod +s /bin/netstat;
mkdir /etc/zabbix/scripts;
cd /etc/zabbix/zabbix_agentd.conf.d;
wget http://bjqw-dl.bjtuling.com:8180/zabbix/zabbix_scripts/userparameter_mongodb.conf;
chown -R zabbix.zabbix /etc/zabbix/;
/etc/init.d/zabbix_agentd restart
一句话安装脚本
cd /usr/local/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_mongodb_status.sh;sh init_zabbix_mongodb_status.sh
6. 监控io
cd /usr/local/src;wget http://bjqw-dl.bjtuling.com:8180/zabbix/init_scripts/init_zabbix_iostat_status.sh;sh init_zabbix_iostat_status.sh





</code></pre>

<p>监控JVM相关</p>

<pre><code>yum install -y java-devel zabbix-java-gateway
systemctl start zabbix-java-gateway.service
systemctl enable zabbix-java-gateway.service

vim /etc/zabbix/zabbix_java_gateway.conf
LISTEN_IP=&quot;0.0.0.0&quot;
LISTEN_PORT=10052
PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;
START_POLLERS=20

vim /etc/zabbix/zabbix_server.conf 
JavaGateway=192.168.89.204
JavaGatewayPort=10052
StartJavaPollers=20
</code></pre>

<p>zabbix故障排查</p>

<ol>
<li>Too many processes on Zabbix server</li>
</ol>

<pre><code>配置-模板-Template_Linux
Configuration--&gt;Templates找到Template_Linux点该行的 Triggers选择：Too many processes on {HOSTNAME}，表达式修改为：
{Template OS Linux:proc.num[].avg(5m)}&gt;500
2. &quot;cannot send list of active checks to []: host [] not found&quot;
解决办法:
因为web端上被监控端的主机名和zabbix_agentd.conf中的Hostname名字不一样,改为一样的即可
参考文档
中小企业监控体系构建实战：微信 赵舜东 高效运维
使用zabbix监控TCP连接状态：http://blog.csdn.net/u013636377/article/details/51611670
- zabbix模板：https://share.zabbix.com/search-by/tags?value=netkiller
</code></pre>

<ol>
<li>org.json.JSONException: No value for jmx_endpoint</li>
</ol>

<pre><code>清理zabbix其他YUM源（特别是高版本）
rpm -i http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm
yum clean all
yum install  zabbix-java-gateway
systemctl restart zabbix-java-gateway.service 
tail -fn200 /var/log/zabbix/zabbix_java_gateway.log
</code></pre>

<ol>
<li>Error connecting to database: Connection refused</li>
</ol>

<pre><code>排查过程：
1.检查zabbix_server.conf配置文件，发现数据库配置也是正确的，但就是报上面的错误
2.最后通过网上搜索，发现
******/zabbix/conf/zabbix.conf.php
文件里面也有数据库的配置不正确
</code></pre>

<ol>
<li>初始admin 密码</li>
</ol>

<pre><code>use zabbix; 
select * from users;
select userid,passwd from users;

#生成一个MD5加密的密码，这里密码设置的是zabbix
select md5(&#39;zabbix&#39;);
update users set passwd=&#39;5fce1b3e34b520afeffb37ce08c7cd66&#39; where userid = &#39;1&#39;;
       #或者直接使用update  users set passwd=md5(&quot;redhat&quot;) where userid=&#39;1&#39;;
flush privileges;
</code></pre>

<ol>
<li>LDAP</li>
</ol>

<p>zabbix不会把ldap的用户同步过了，你要登录，得先在zabbix上创建和ldap内同名的用户才行<br/>
<img src="media/15246196912882/15284255403350.jpg" alt=""/></p>

<pre><code>LDAP host：访问DC的地址。格式：ldap://ip地址
Port：默认389
Base DN: dc=tencent,dc=com,也就是域名(tencent.com)
Search attribute: uid，属性值，网上有填sAMAccountName。

Bind DN： cn=Admin, ou=People, dc=tencent, dc=com。 cn就是在DC中创建的LDAPuser用户， ou就是LDAPuser属于哪个ou，dc=tencent和dc=com不在解释。

Bind password：xxxx ，改密码为LDAPuser用户的密码
Login：Admin
User password：在DC中创建Admin用户的密码

</code></pre>

<p>参考：<a href="https://www.jianshu.com/p/2326f1ec2c2b">https://www.jianshu.com/p/2326f1ec2c2b</a></p>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15246459775922.html"  title="Previous Post: zabbix3.2升级到3.4">&laquo; zabbix3.2升级到3.4</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15243054043731.html" 
	        title="Next Post: 天兔">天兔 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15246196912882.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
