<!DOCTYPE html>
<html>

<head>
    <title>
         3.1.4 第4章 数据库结构优化 - 安红雷 - An Honglei ’s Blog 
    </title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="从心开始">

    <link rel="stylesheet" type="text/css" href="asset/yue.css">
    <link rel="stylesheet" type="text/css" href="asset/main.css">
    <link rel="stylesheet" type="text/css" href="asset/tomorrow.css">

    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="An Honglei ’s Blog">

    <script src="asset/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <header class="yue site-header">
        <div class="wrapper">
            <a class="site-title" href="index.html">An Honglei ’s Blog</a>
            <nav class="site-nav">
                <a href="#" class="menu-icon">
                    
                    <svg viewBox="0 0 18 15">
                        <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"
                        />
                        <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"
                        />
                        <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"
                        />
                    </svg>

                </a>
                <div class="trigger">
                    
                        <a class="page-link" href="index.html">Home</a>
                    
                        <a class="page-link" href="archives.html">Archives</a>
                    
                        <a class="page-link" href="/docker">Docker</a>
                    
                </div>
            </nav>
        </div>
    </header>
</body>

</html> <script async defer src="//hypothes.is/embed.js"></script>
<div class="page-content yue">
    <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">3.1.4 第4章 数据库结构优化 - 安红雷</h1>
                <div class="post-description">
                    
                        <p>慕课网视频地址：<a href="https://www.imooc.com/learn/194">https://www.imooc.com/learn/194</a><br/>
课程要点：</p>

<h3 id="toc_0">选择合适的数据类型</h3>

<p>数据库类型的选择，重点在于合适两字，如何确定选择的数据类型是否合适？<br/>
1、使用可以存下你要存数据的最小数据类型<br/>
2、使用简单的数据类型。int要比varchar处理逻辑简单高效<br/>
3、尽可能使用not null的定义字段<br/>
        在设计或创建表时，最好加上not null属性或给一个默认值，这是由于innodb对于非not null的列需要额外的字段来存储，会增加IO和存储的开销<br/>
4、尽量少用text类型，非用不可最好考虑分表<br/>
        必须使用时，建议将这些类型的列分别提出来，创建一个附加表中，这样可以提高主表的查询效率也能在根据需要的情况去附加表去查询</p>

<p><strong>使用int 存储日期时间，利用from_unixtime(),unix_timestamp()两个函数来进行转换。</strong></p>

<pre><code>
root@localhost:sakila 09:03:08 &gt;create table test(id int auto_increment not null,timetr int,primary key(id));
Query OK, 0 rows affected (0.04 sec)

root@localhost:sakila 09:04:41 &gt;insert into test(timetr) values(unix_timestamp(&#39;2014-06-01 13:12:00&#39;));
Query OK, 1 row affected (0.00 sec)

root@localhost:sakila 09:05:36 &gt;select from_unixtime(timetr) from test; 
+-----------------------+
| from_unixtime(timetr) |
+-----------------------+
| 2014-06-01 13:12:00   |
+-----------------------+
1 row in set (0.00 sec)

</code></pre>

<p><strong>使用bigint来存储IP地址，利用inet_aton(),inet_ntoa()两个函数来转换</strong></p>

<pre><code>root@localhost:sakila 09:06:03 &gt;create table sessions(id int auto_increment not null,ipaddress bigint,primary key(id));
Query OK, 0 rows affected (0.03 sec)

root@localhost:sakila 09:17:33 &gt;insert into sessions(ipaddress) values(inet_aton(&#39;192.168.0.1&#39;));
Query OK, 1 row affected (0.01 sec)

root@localhost:sakila 09:18:35 &gt;select inet_ntoa(ipaddress) from sessions;
+----------------------+
| inet_ntoa(ipaddress) |
+----------------------+
| 192.168.0.1          |
+----------------------+
1 row in set (0.00 sec)

分析：
这样不仅在空间上可以节约，另外在IP地址的对比上也有好处，因为整型的对比比varchar更简洁高效
</code></pre>

<h3 id="toc_1">数据库表的范式化优化</h3>

<p><strong>表的范式化</strong><br/>
范式化是指数据库设计的规范，目前说到范式化一般是指第三设计范式，也就是要求数据表不存在非关键字段对任意候选关键字段的传递函数依赖则符合第三范式</p>

<p><img src="media/15159240750033/15162824616484.jpg" alt=""/></p>

<p>不符合第三范式要求存在的一些问题：<br/>
1、数据冗余：（分类，分类描述）对于每一个商品都会进行记录<br/>
2、数据的插入异常<br/>
3、数据的更新异常<br/>
4、数据的删除异常</p>

<p><img src="media/15159240750033/15162828245198.jpg" alt=""/></p>

<p><strong>反范式化</strong><br/>
反范式化是指为了查询效率的考虑把原本符合第三范式的表适当的增加冗余，以达到优化查询效率的目的，反范式化是一种以空间换取时间的操作（如果完全遵照范式化操作，在进行查询时会关联很多的表，但表关联较多时就会影响查询效率）</p>

<p><img src="media/15159240750033/15162833086220.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162835811897.jpg" alt=""/><br/>
这样优化这种SQL是从语句角度会很难操作。</p>

<p><img src="media/15159240750033/15162836668532.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162836844255.jpg" alt=""/></p>

<p><strong>表的垂直拆分</strong><br/>
所谓的垂直拆分，就是把原来的一个有很多列的表拆分成多个表，这解决了表的宽度问题。通常垂直拆分可以按以下原则进行：<br/>
1、把不常用的字段单独存放到一个表中<br/>
2、把大字段独立存放到一个表中<br/>
3、把经常一起使用的字段放到一起</p>

<p><img src="media/15159240750033/15162839577745.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162840505111.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162840644745.jpg" alt=""/></p>

<p><strong>表的水平拆分</strong></p>

<p>表的水平拆分主是是为了解决单表的数据量过大的问题，水平拆分的表每一个表的结构都是完全一致的。</p>

<p><img src="media/15159240750033/15162842031537.jpg" alt=""/></p>

<p>常用的水平拆分方法为：<br/>
1、对customer_id 进行hash运算，如果要拆分成5个表则使用mod(customer_id,5)取出0-5个值<br/>
2、针对不同的hashID把数据存到不同的表中</p>

<p>挑战<br/>
1、跨分区表进行数据查询<br/>
2、统计及后台报表操作</p>

<p>通常情况下，需要区分开前后台业务，我们需要把统计后台的分区表汇总成一个汇总表，（因为前台讲究是效率，后台考虑的是数据的完整性无需很效率）</p>

<h3 id="toc_2">3. 对于本章9个节点的学习，做好总结的学习笔记。</h3>

<p>安红雷、刘宏伟、王恩志可以给予运维环境方面的支持。<br/>
作业：<br/>
查看视频，针对以上9个学习点，形成笔记，转换PDF上传至Seafile。<br/>
注意事项：<br/>
完成学习后，修改计划完成日期为真实完成日期。</p>

                    
                </div>
                <p class="post-meta">
                    <time class="post-time" datetime="2018-01-14T18:01:15+08:00"itemprop="datePublished">Created by Tisoga at 2018/1/14</time>
                </p>
            </header>
            <div class="post-content" itemprop="articleBody">
                <p>慕课网视频地址：<a href="https://www.imooc.com/learn/194">https://www.imooc.com/learn/194</a><br/>
课程要点：</p>

<h3 id="toc_0">选择合适的数据类型</h3>

<p>数据库类型的选择，重点在于合适两字，如何确定选择的数据类型是否合适？<br/>
1、使用可以存下你要存数据的最小数据类型<br/>
2、使用简单的数据类型。int要比varchar处理逻辑简单高效<br/>
3、尽可能使用not null的定义字段<br/>
        在设计或创建表时，最好加上not null属性或给一个默认值，这是由于innodb对于非not null的列需要额外的字段来存储，会增加IO和存储的开销<br/>
4、尽量少用text类型，非用不可最好考虑分表<br/>
        必须使用时，建议将这些类型的列分别提出来，创建一个附加表中，这样可以提高主表的查询效率也能在根据需要的情况去附加表去查询</p>

<p><strong>使用int 存储日期时间，利用from_unixtime(),unix_timestamp()两个函数来进行转换。</strong></p>

<pre><code>
root@localhost:sakila 09:03:08 &gt;create table test(id int auto_increment not null,timetr int,primary key(id));
Query OK, 0 rows affected (0.04 sec)

root@localhost:sakila 09:04:41 &gt;insert into test(timetr) values(unix_timestamp(&#39;2014-06-01 13:12:00&#39;));
Query OK, 1 row affected (0.00 sec)

root@localhost:sakila 09:05:36 &gt;select from_unixtime(timetr) from test; 
+-----------------------+
| from_unixtime(timetr) |
+-----------------------+
| 2014-06-01 13:12:00   |
+-----------------------+
1 row in set (0.00 sec)

</code></pre>

<p><strong>使用bigint来存储IP地址，利用inet_aton(),inet_ntoa()两个函数来转换</strong></p>

<pre><code>root@localhost:sakila 09:06:03 &gt;create table sessions(id int auto_increment not null,ipaddress bigint,primary key(id));
Query OK, 0 rows affected (0.03 sec)

root@localhost:sakila 09:17:33 &gt;insert into sessions(ipaddress) values(inet_aton(&#39;192.168.0.1&#39;));
Query OK, 1 row affected (0.01 sec)

root@localhost:sakila 09:18:35 &gt;select inet_ntoa(ipaddress) from sessions;
+----------------------+
| inet_ntoa(ipaddress) |
+----------------------+
| 192.168.0.1          |
+----------------------+
1 row in set (0.00 sec)

分析：
这样不仅在空间上可以节约，另外在IP地址的对比上也有好处，因为整型的对比比varchar更简洁高效
</code></pre>

<h3 id="toc_1">数据库表的范式化优化</h3>

<p><strong>表的范式化</strong><br/>
范式化是指数据库设计的规范，目前说到范式化一般是指第三设计范式，也就是要求数据表不存在非关键字段对任意候选关键字段的传递函数依赖则符合第三范式</p>

<p><img src="media/15159240750033/15162824616484.jpg" alt=""/></p>

<p>不符合第三范式要求存在的一些问题：<br/>
1、数据冗余：（分类，分类描述）对于每一个商品都会进行记录<br/>
2、数据的插入异常<br/>
3、数据的更新异常<br/>
4、数据的删除异常</p>

<p><img src="media/15159240750033/15162828245198.jpg" alt=""/></p>

<p><strong>反范式化</strong><br/>
反范式化是指为了查询效率的考虑把原本符合第三范式的表适当的增加冗余，以达到优化查询效率的目的，反范式化是一种以空间换取时间的操作（如果完全遵照范式化操作，在进行查询时会关联很多的表，但表关联较多时就会影响查询效率）</p>

<p><img src="media/15159240750033/15162833086220.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162835811897.jpg" alt=""/><br/>
这样优化这种SQL是从语句角度会很难操作。</p>

<p><img src="media/15159240750033/15162836668532.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162836844255.jpg" alt=""/></p>

<p><strong>表的垂直拆分</strong><br/>
所谓的垂直拆分，就是把原来的一个有很多列的表拆分成多个表，这解决了表的宽度问题。通常垂直拆分可以按以下原则进行：<br/>
1、把不常用的字段单独存放到一个表中<br/>
2、把大字段独立存放到一个表中<br/>
3、把经常一起使用的字段放到一起</p>

<p><img src="media/15159240750033/15162839577745.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162840505111.jpg" alt=""/></p>

<p><img src="media/15159240750033/15162840644745.jpg" alt=""/></p>

<p><strong>表的水平拆分</strong></p>

<p>表的水平拆分主是是为了解决单表的数据量过大的问题，水平拆分的表每一个表的结构都是完全一致的。</p>

<p><img src="media/15159240750033/15162842031537.jpg" alt=""/></p>

<p>常用的水平拆分方法为：<br/>
1、对customer_id 进行hash运算，如果要拆分成5个表则使用mod(customer_id,5)取出0-5个值<br/>
2、针对不同的hashID把数据存到不同的表中</p>

<p>挑战<br/>
1、跨分区表进行数据查询<br/>
2、统计及后台报表操作</p>

<p>通常情况下，需要区分开前后台业务，我们需要把统计后台的分区表汇总成一个汇总表，（因为前台讲究是效率，后台考虑的是数据的完整性无需很效率）</p>

<h3 id="toc_2">3. 对于本章9个节点的学习，做好总结的学习笔记。</h3>

<p>安红雷、刘宏伟、王恩志可以给予运维环境方面的支持。<br/>
作业：<br/>
查看视频，针对以上9个学习点，形成笔记，转换PDF上传至Seafile。<br/>
注意事项：<br/>
完成学习后，修改计划完成日期为真实完成日期。</p>

            </div>
            <div>
                22222
                
                
            </div>
        </article>
    </div>
</div>
  <footer id="footer" class="yue">
    <div class="wrapper">
        <p>Designed and Written by <a href="https://twitter.com/Tisoga">Tisoga</a></p>
    </div>
</footer>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
3333